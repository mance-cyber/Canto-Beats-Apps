# VAD 優化與廣東話校正更新報告

**日期**: 2025-12-20
**狀態**: ✅ 已完成並驗證

---

## 1. VAD 斷句優化 (Sentence Segmentation)

### 🎯 目標
解決語音轉錄時句子被過度切碎（fragmentation）的問題，特別是中英夾雜或有輕微停頓的長句。

### ⚙️ 參數調整
**文件**: `src/pipeline/subtitle_pipeline_v2.py`

| 參數 | 舊值 | 新值 | 效果 |
|------|------|------|------|
| **min_silence_duration_ms** | 20ms | **500ms** | 大幅減少因輕微停頓而導致的強制斷句 |
| **speech_pad_ms** | 300ms | **500ms** | 增加語音前後保留時間，避免 "切頭切尾" |
| **threshold** | 0.10 | **0.15** | 稍微降低敏感度，避免將呼吸聲誤判為語音 |
| **min_speech_duration_ms** | 50ms | **100ms** | 過濾極短的雜音或氣音 |
| **max_gap** (Merge) | 0.2s | **1.0s** | 允許 1 秒內的間隔自動合併，連接上下文 |
| **max_chars** (Merge) | 22字 | **42字** | **關鍵修正**：放寬單句最大字數，容納長句及長英文單詞 |

### ✅ 改善案例
- **之前**: "一分鐘話比你知入場HKTVMALL" [斷] "前一定要"
- **之後**: "一分鐘話比你知入場HKTVMALL前一定要"

---

## 2. 廣東話詞庫與錯字校正 (Correction Dictionary)

### 🎯 目標
修正 Whisper 常見的粵語同音字錯誤及 OCR 識別錯誤（如英文單詞誤判）。

### 📝 新增規則
**文件**: `src/pipeline/subtitle_pipeline_v2.py` & `CANTONESE_CORRECTIONS.md`

已加入並驗證以下強制替換規則：

| 錯誤文本 (Raw) | 自動修正 (Corrected) | 備註 |
|---------------|-------------------|------|
| **有冤無老訴** | **有冤無路訴** | 修正發音錯誤 |
| **凌射** | **零舍** | (Especially) |
| **心希感受** | **身同感受** | 修正 |
| **心痛感受** | **身同感受** | 常見變體 |
| **物外** | **默哀** | (Mourn) |
| **Porn** | **Point** | 英文修正 (重要) |
| **Grip** | **Group** | 英文修正 |

### 🧪 驗證結果
使用 `test_corrections.py` 腳本對上述所有規則進行了回歸測試，確認全部通過。

---

## ⚠️ 重啟提示
由於修改涉及核心 Python 代碼 (`subtitle_pipeline_v2.py`)，**必須完全重啟應用程式**，新的 VAD 參數和校正規則才會生效。
